"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _debug = _interopRequireDefault(require("debug"));

var _googleAuthLibrary = require("google-auth-library");

var _path = _interopRequireDefault(require("path"));

var _mkdirp = _interopRequireDefault(require("mkdirp"));

var _lowdb = _interopRequireDefault(require("lowdb"));

var _FileSync = _interopRequireDefault(require("lowdb/adapters/FileSync"));

var _Memory = _interopRequireDefault(require("lowdb/adapters/Memory"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const debug = (0, _debug.default)('md2gslides');

/**
 * Handles the authorization flow, intended for command line usage.
 *
 * @example
 *   var auth = new UserAuthorizer({
 *     clientId: 'my-client-id',
 *     clientSecret: 'my-client-secret',
 *     filePath: '/path/to/persistent/token/storage'
 *     prompt: function(url) { ... }
 *   });
 *
 *   var credentials = auth.getUserCredentials('user@example.com', 'https://www.googleapis.com/auth/slides');
 *   credentials.then(function(oauth2Client) {
 *     // Valid oauth2Client for use with google APIs.
 *   });
 *
 *   @callback UserAuthorizer-promptCallback
 *   @param {String} url Authorization URL to display to user or open in browser
 *   @returns {Promise.<String>} Promise yielding the authorization code
 */
class UserAuthorizer {
  /**
   * Initialize the authorizer.
   *
   * This may block briefly to ensure the token file exists.
   *
   * @param {String} clientId Client ID
   * @param {String} clientSecret Client secret
   * @param {String} filePath Path to file where tokens are saved
   * @param {UserAuthorizer~promptCallback} prompt Function to acquire the authorization code
   */
  constructor(options) {
    _defineProperty(this, "redirectUrl", 'urn:ietf:wg:oauth:2.0:oob');

    _defineProperty(this, "db", void 0);

    _defineProperty(this, "clientId", void 0);

    _defineProperty(this, "clientSecret", void 0);

    _defineProperty(this, "prompt", void 0);

    this.db = this.initDbSync(options.filePath);
    this.clientId = options.clientId;
    this.clientSecret = options.clientSecret;
    this.prompt = options.prompt;
  }
  /**
   * Fetch credentials for the specified user.
   *
   * If no credentials are available, requests authorization.
   *
   * @param {String} user ID (email address) of user to get credentials for.
   * @param {String} scopes Authorization scopes to request
   * @returns {Promise.<google.auth.OAuth2>}
   */


  async getUserCredentials(user, scopes) {
    const oauth2Client = new _googleAuthLibrary.OAuth2Client(this.clientId, this.clientSecret, this.redirectUrl);
    oauth2Client.on('tokens', tokens => {
      if (tokens.refresh_token) {
        debug('Saving refresh token');
        this.db.set(user, tokens).write();
      }
    });
    let tokens = this.db.get(user).value();

    if (tokens) {
      debug('User previously authorized, refreshing');
      oauth2Client.setCredentials(tokens);
      await oauth2Client.getAccessToken();
      return oauth2Client;
    }

    debug('Challenging for authorization');
    /* eslint-disable @typescript-eslint/camelcase */

    const authUrl = oauth2Client.generateAuthUrl({
      access_type: 'offline',
      scope: scopes,
      login_hint: user
    });
    let code = await this.prompt(authUrl);
    let tokenResponse = await oauth2Client.getToken(code);
    oauth2Client.setCredentials(tokenResponse.tokens);
    return oauth2Client;
  }
  /**
   * Initialzes the token database.
   *
   * @param {String} filePath Path to database, null if use in-memory DB only.
   * @returns {lowdb} database instance
   * @private
   */


  initDbSync(filePath) {
    let adapter;

    if (filePath) {
      const parentDir = _path.default.dirname(filePath);

      _mkdirp.default.sync(parentDir);

      adapter = new _FileSync.default(filePath);
    } else {
      adapter = new _Memory.default('');
    }

    return (0, _lowdb.default)(adapter);
  }

}

exports.default = UserAuthorizer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9hdXRoLnRzIl0sIm5hbWVzIjpbImRlYnVnIiwiVXNlckF1dGhvcml6ZXIiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJkYiIsImluaXREYlN5bmMiLCJmaWxlUGF0aCIsImNsaWVudElkIiwiY2xpZW50U2VjcmV0IiwicHJvbXB0IiwiZ2V0VXNlckNyZWRlbnRpYWxzIiwidXNlciIsInNjb3BlcyIsIm9hdXRoMkNsaWVudCIsIk9BdXRoMkNsaWVudCIsInJlZGlyZWN0VXJsIiwib24iLCJ0b2tlbnMiLCJyZWZyZXNoX3Rva2VuIiwic2V0Iiwid3JpdGUiLCJnZXQiLCJ2YWx1ZSIsInNldENyZWRlbnRpYWxzIiwiZ2V0QWNjZXNzVG9rZW4iLCJhdXRoVXJsIiwiZ2VuZXJhdGVBdXRoVXJsIiwiYWNjZXNzX3R5cGUiLCJzY29wZSIsImxvZ2luX2hpbnQiLCJjb2RlIiwidG9rZW5SZXNwb25zZSIsImdldFRva2VuIiwiYWRhcHRlciIsInBhcmVudERpciIsInBhdGgiLCJkaXJuYW1lIiwibWtkaXJwIiwic3luYyIsIkZpbGVTeW5jIiwiTWVtb3J5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBY0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVBLE1BQU1BLEtBQUssR0FBRyxvQkFBTSxZQUFOLENBQWQ7O0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNlLE1BQU1DLGNBQU4sQ0FBcUI7QUFPaEM7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDV0MsRUFBQUEsV0FBUCxDQUFtQkMsT0FBbkIsRUFBeUM7QUFBQSx5Q0FoQm5CLDJCQWdCbUI7O0FBQUE7O0FBQUE7O0FBQUE7O0FBQUE7O0FBQ3JDLFNBQUtDLEVBQUwsR0FBVSxLQUFLQyxVQUFMLENBQWdCRixPQUFPLENBQUNHLFFBQXhCLENBQVY7QUFDQSxTQUFLQyxRQUFMLEdBQWdCSixPQUFPLENBQUNJLFFBQXhCO0FBQ0EsU0FBS0MsWUFBTCxHQUFvQkwsT0FBTyxDQUFDSyxZQUE1QjtBQUNBLFNBQUtDLE1BQUwsR0FBY04sT0FBTyxDQUFDTSxNQUF0QjtBQUNIO0FBRUQ7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDSSxRQUFhQyxrQkFBYixDQUFnQ0MsSUFBaEMsRUFBOENDLE1BQTlDLEVBQXFGO0FBQ2pGLFVBQU1DLFlBQVksR0FBRyxJQUFJQywrQkFBSixDQUFpQixLQUFLUCxRQUF0QixFQUFnQyxLQUFLQyxZQUFyQyxFQUFtRCxLQUFLTyxXQUF4RCxDQUFyQjtBQUNBRixJQUFBQSxZQUFZLENBQUNHLEVBQWIsQ0FBZ0IsUUFBaEIsRUFBMkJDLE1BQUQsSUFBeUI7QUFDL0MsVUFBSUEsTUFBTSxDQUFDQyxhQUFYLEVBQTBCO0FBQ3RCbEIsUUFBQUEsS0FBSyxDQUFDLHNCQUFELENBQUw7QUFDQSxhQUFLSSxFQUFMLENBQVFlLEdBQVIsQ0FBWVIsSUFBWixFQUFrQk0sTUFBbEIsRUFBMEJHLEtBQTFCO0FBQ0g7QUFDSixLQUxEO0FBT0EsUUFBSUgsTUFBTSxHQUFHLEtBQUtiLEVBQUwsQ0FBUWlCLEdBQVIsQ0FBWVYsSUFBWixFQUFrQlcsS0FBbEIsRUFBYjs7QUFDQSxRQUFJTCxNQUFKLEVBQVk7QUFDUmpCLE1BQUFBLEtBQUssQ0FBQyx3Q0FBRCxDQUFMO0FBQ0FhLE1BQUFBLFlBQVksQ0FBQ1UsY0FBYixDQUE0Qk4sTUFBNUI7QUFDQSxZQUFNSixZQUFZLENBQUNXLGNBQWIsRUFBTjtBQUNBLGFBQU9YLFlBQVA7QUFDSDs7QUFFRGIsSUFBQUEsS0FBSyxDQUFDLCtCQUFELENBQUw7QUFDQTs7QUFDQSxVQUFNeUIsT0FBTyxHQUFHWixZQUFZLENBQUNhLGVBQWIsQ0FBNkI7QUFDekNDLE1BQUFBLFdBQVcsRUFBRSxTQUQ0QjtBQUV6Q0MsTUFBQUEsS0FBSyxFQUFFaEIsTUFGa0M7QUFHekNpQixNQUFBQSxVQUFVLEVBQUVsQjtBQUg2QixLQUE3QixDQUFoQjtBQUtBLFFBQUltQixJQUFJLEdBQUcsTUFBTSxLQUFLckIsTUFBTCxDQUFZZ0IsT0FBWixDQUFqQjtBQUNBLFFBQUlNLGFBQWEsR0FBRyxNQUFNbEIsWUFBWSxDQUFDbUIsUUFBYixDQUFzQkYsSUFBdEIsQ0FBMUI7QUFDQWpCLElBQUFBLFlBQVksQ0FBQ1UsY0FBYixDQUE0QlEsYUFBYSxDQUFDZCxNQUExQztBQUNBLFdBQU9KLFlBQVA7QUFDSDtBQUVEO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDWVIsRUFBQUEsVUFBUixDQUFzQkMsUUFBdEIsRUFBNEQ7QUFDeEQsUUFBSTJCLE9BQUo7O0FBQ0EsUUFBSTNCLFFBQUosRUFBYztBQUNWLFlBQU00QixTQUFTLEdBQUdDLGNBQUtDLE9BQUwsQ0FBYTlCLFFBQWIsQ0FBbEI7O0FBQ0ErQixzQkFBT0MsSUFBUCxDQUFZSixTQUFaOztBQUNBRCxNQUFBQSxPQUFPLEdBQUcsSUFBSU0saUJBQUosQ0FBZ0JqQyxRQUFoQixDQUFWO0FBQ0gsS0FKRCxNQUlPO0FBQ0gyQixNQUFBQSxPQUFPLEdBQUcsSUFBSU8sZUFBSixDQUFjLEVBQWQsQ0FBVjtBQUNIOztBQUNELFdBQU8sb0JBQU1QLE9BQU4sQ0FBUDtBQUNIOztBQWhGK0IiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNiBHb29nbGUgSW5jLlxuLy9cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4vLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4vLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbi8vIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgRGVidWcgZnJvbSAnZGVidWcnO1xuaW1wb3J0IHsgT0F1dGgyQ2xpZW50LCBDcmVkZW50aWFscyB9IGZyb20gJ2dvb2dsZS1hdXRoLWxpYnJhcnknO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgbWtkaXJwIGZyb20gJ21rZGlycCc7XG5pbXBvcnQgbG93ZGIgZnJvbSAnbG93ZGInO1xuaW1wb3J0IEZpbGVTeW5jIGZyb20gJ2xvd2RiL2FkYXB0ZXJzL0ZpbGVTeW5jJztcbmltcG9ydCBNZW1vcnkgZnJvbSAnbG93ZGIvYWRhcHRlcnMvTWVtb3J5JztcblxuY29uc3QgZGVidWcgPSBEZWJ1ZygnbWQyZ3NsaWRlcycpO1xuXG5leHBvcnQgdHlwZSBVc2VyUHJvbXB0ID0gKG1lc3NhZ2U6IHN0cmluZykgPT4gUHJvbWlzZTxzdHJpbmc+O1xuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhPcHRpb25zIHtcbiAgICBjbGllbnRJZDogc3RyaW5nO1xuICAgIGNsaWVudFNlY3JldDogc3RyaW5nO1xuICAgIHByb21wdDogVXNlclByb21wdDtcbiAgICBmaWxlUGF0aD86IHN0cmluZztcbn1cblxuLyoqXG4gKiBIYW5kbGVzIHRoZSBhdXRob3JpemF0aW9uIGZsb3csIGludGVuZGVkIGZvciBjb21tYW5kIGxpbmUgdXNhZ2UuXG4gKlxuICogQGV4YW1wbGVcbiAqICAgdmFyIGF1dGggPSBuZXcgVXNlckF1dGhvcml6ZXIoe1xuICogICAgIGNsaWVudElkOiAnbXktY2xpZW50LWlkJyxcbiAqICAgICBjbGllbnRTZWNyZXQ6ICdteS1jbGllbnQtc2VjcmV0JyxcbiAqICAgICBmaWxlUGF0aDogJy9wYXRoL3RvL3BlcnNpc3RlbnQvdG9rZW4vc3RvcmFnZSdcbiAqICAgICBwcm9tcHQ6IGZ1bmN0aW9uKHVybCkgeyAuLi4gfVxuICogICB9KTtcbiAqXG4gKiAgIHZhciBjcmVkZW50aWFscyA9IGF1dGguZ2V0VXNlckNyZWRlbnRpYWxzKCd1c2VyQGV4YW1wbGUuY29tJywgJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL2F1dGgvc2xpZGVzJyk7XG4gKiAgIGNyZWRlbnRpYWxzLnRoZW4oZnVuY3Rpb24ob2F1dGgyQ2xpZW50KSB7XG4gKiAgICAgLy8gVmFsaWQgb2F1dGgyQ2xpZW50IGZvciB1c2Ugd2l0aCBnb29nbGUgQVBJcy5cbiAqICAgfSk7XG4gKlxuICogICBAY2FsbGJhY2sgVXNlckF1dGhvcml6ZXItcHJvbXB0Q2FsbGJhY2tcbiAqICAgQHBhcmFtIHtTdHJpbmd9IHVybCBBdXRob3JpemF0aW9uIFVSTCB0byBkaXNwbGF5IHRvIHVzZXIgb3Igb3BlbiBpbiBicm93c2VyXG4gKiAgIEByZXR1cm5zIHtQcm9taXNlLjxTdHJpbmc+fSBQcm9taXNlIHlpZWxkaW5nIHRoZSBhdXRob3JpemF0aW9uIGNvZGVcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckF1dGhvcml6ZXIge1xuICAgIHByaXZhdGUgcmVkaXJlY3RVcmwgPSAndXJuOmlldGY6d2c6b2F1dGg6Mi4wOm9vYic7XG4gICAgcHJpdmF0ZSBkYjogbG93ZGIuTG93ZGJTeW5jPENyZWRlbnRpYWxzPjtcbiAgICBwcml2YXRlIGNsaWVudElkOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBjbGllbnRTZWNyZXQ6IHN0cmluZztcbiAgICBwcml2YXRlIHByb21wdDogVXNlclByb21wdDtcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgdGhlIGF1dGhvcml6ZXIuXG4gICAgICpcbiAgICAgKiBUaGlzIG1heSBibG9jayBicmllZmx5IHRvIGVuc3VyZSB0aGUgdG9rZW4gZmlsZSBleGlzdHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2xpZW50SWQgQ2xpZW50IElEXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGNsaWVudFNlY3JldCBDbGllbnQgc2VjcmV0XG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGZpbGVQYXRoIFBhdGggdG8gZmlsZSB3aGVyZSB0b2tlbnMgYXJlIHNhdmVkXG4gICAgICogQHBhcmFtIHtVc2VyQXV0aG9yaXplcn5wcm9tcHRDYWxsYmFja30gcHJvbXB0IEZ1bmN0aW9uIHRvIGFjcXVpcmUgdGhlIGF1dGhvcml6YXRpb24gY29kZVxuICAgICAqL1xuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihvcHRpb25zOiBBdXRoT3B0aW9ucykge1xuICAgICAgICB0aGlzLmRiID0gdGhpcy5pbml0RGJTeW5jKG9wdGlvbnMuZmlsZVBhdGgpO1xuICAgICAgICB0aGlzLmNsaWVudElkID0gb3B0aW9ucy5jbGllbnRJZDtcbiAgICAgICAgdGhpcy5jbGllbnRTZWNyZXQgPSBvcHRpb25zLmNsaWVudFNlY3JldDtcbiAgICAgICAgdGhpcy5wcm9tcHQgPSBvcHRpb25zLnByb21wdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCBjcmVkZW50aWFscyBmb3IgdGhlIHNwZWNpZmllZCB1c2VyLlxuICAgICAqXG4gICAgICogSWYgbm8gY3JlZGVudGlhbHMgYXJlIGF2YWlsYWJsZSwgcmVxdWVzdHMgYXV0aG9yaXphdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1c2VyIElEIChlbWFpbCBhZGRyZXNzKSBvZiB1c2VyIHRvIGdldCBjcmVkZW50aWFscyBmb3IuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHNjb3BlcyBBdXRob3JpemF0aW9uIHNjb3BlcyB0byByZXF1ZXN0XG4gICAgICogQHJldHVybnMge1Byb21pc2UuPGdvb2dsZS5hdXRoLk9BdXRoMj59XG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIGdldFVzZXJDcmVkZW50aWFscyh1c2VyOiBzdHJpbmcsIHNjb3Blczogc3RyaW5nKTogUHJvbWlzZTxPQXV0aDJDbGllbnQ+IHtcbiAgICAgICAgY29uc3Qgb2F1dGgyQ2xpZW50ID0gbmV3IE9BdXRoMkNsaWVudCh0aGlzLmNsaWVudElkLCB0aGlzLmNsaWVudFNlY3JldCwgdGhpcy5yZWRpcmVjdFVybCk7XG4gICAgICAgIG9hdXRoMkNsaWVudC5vbigndG9rZW5zJywgKHRva2VuczogQ3JlZGVudGlhbHMpID0+IHtcbiAgICAgICAgICAgIGlmICh0b2tlbnMucmVmcmVzaF90b2tlbikge1xuICAgICAgICAgICAgICAgIGRlYnVnKCdTYXZpbmcgcmVmcmVzaCB0b2tlbicpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGIuc2V0KHVzZXIsIHRva2Vucykud3JpdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IHRva2VucyA9IHRoaXMuZGIuZ2V0KHVzZXIpLnZhbHVlKCk7XG4gICAgICAgIGlmICh0b2tlbnMpIHtcbiAgICAgICAgICAgIGRlYnVnKCdVc2VyIHByZXZpb3VzbHkgYXV0aG9yaXplZCwgcmVmcmVzaGluZycpO1xuICAgICAgICAgICAgb2F1dGgyQ2xpZW50LnNldENyZWRlbnRpYWxzKHRva2Vucyk7XG4gICAgICAgICAgICBhd2FpdCBvYXV0aDJDbGllbnQuZ2V0QWNjZXNzVG9rZW4oKTtcbiAgICAgICAgICAgIHJldHVybiBvYXV0aDJDbGllbnQ7XG4gICAgICAgIH1cblxuICAgICAgICBkZWJ1ZygnQ2hhbGxlbmdpbmcgZm9yIGF1dGhvcml6YXRpb24nKTtcbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L2NhbWVsY2FzZSAqL1xuICAgICAgICBjb25zdCBhdXRoVXJsID0gb2F1dGgyQ2xpZW50LmdlbmVyYXRlQXV0aFVybCh7XG4gICAgICAgICAgICBhY2Nlc3NfdHlwZTogJ29mZmxpbmUnLFxuICAgICAgICAgICAgc2NvcGU6IHNjb3BlcyxcbiAgICAgICAgICAgIGxvZ2luX2hpbnQ6IHVzZXIsXG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgY29kZSA9IGF3YWl0IHRoaXMucHJvbXB0KGF1dGhVcmwpO1xuICAgICAgICBsZXQgdG9rZW5SZXNwb25zZSA9IGF3YWl0IG9hdXRoMkNsaWVudC5nZXRUb2tlbihjb2RlKTtcbiAgICAgICAgb2F1dGgyQ2xpZW50LnNldENyZWRlbnRpYWxzKHRva2VuUmVzcG9uc2UudG9rZW5zKTtcbiAgICAgICAgcmV0dXJuIG9hdXRoMkNsaWVudDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsemVzIHRoZSB0b2tlbiBkYXRhYmFzZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmaWxlUGF0aCBQYXRoIHRvIGRhdGFiYXNlLCBudWxsIGlmIHVzZSBpbi1tZW1vcnkgREIgb25seS5cbiAgICAgKiBAcmV0dXJucyB7bG93ZGJ9IGRhdGFiYXNlIGluc3RhbmNlXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwcml2YXRlIGluaXREYlN5bmM8VD4oZmlsZVBhdGg6IHN0cmluZyk6IGxvd2RiLkxvd2RiU3luYzxUPiB7XG4gICAgICAgIGxldCBhZGFwdGVyOiBsb3dkYi5BZGFwdGVyU3luYztcbiAgICAgICAgaWYgKGZpbGVQYXRoKSB7XG4gICAgICAgICAgICBjb25zdCBwYXJlbnREaXIgPSBwYXRoLmRpcm5hbWUoZmlsZVBhdGgpO1xuICAgICAgICAgICAgbWtkaXJwLnN5bmMocGFyZW50RGlyKTtcbiAgICAgICAgICAgIGFkYXB0ZXIgPSBuZXcgRmlsZVN5bmM8VD4oZmlsZVBhdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYWRhcHRlciA9IG5ldyBNZW1vcnk8VD4oJycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsb3dkYihhZGFwdGVyKTtcbiAgICB9XG59XG4iXX0=
//# sourceMappingURL=auth.js.map