"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _debug = _interopRequireDefault(require("debug"));

var _extract_slides = _interopRequireDefault(require("./parser/extract_slides"));

var _match_layout = _interopRequireDefault(require("./layout/match_layout"));

var _url = require("url");

var _googleapis = require("googleapis");

var _upload = _interopRequireDefault(require("./images/upload"));

var _probe = _interopRequireDefault(require("./images/probe"));

var _generate = _interopRequireDefault(require("./images/generate"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const debug = (0, _debug.default)('md2gslides');
/**
 * Generates slides from Markdown or HTML. Requires an authorized
 * oauth2 client.
 *
 * @example
 *
 *   var SlideGenerator = require('md2slides');
 *   var fs = require('fs');
 *
 *   var oauth2Client = ...; // See Google API client for details
 *   var generator = SlideGenerator.newPresentation(oauth2Client);
 *   var markdown = fs.readFileSync('mydeck.md');
 *   generator.generateFromMarkdown(markdown).then(function(id) {
 *     console.log("Presentation ID: " + id);
 *   });
 *
 * @see https://github.com/google/google-api-nodejs-client
 */

class SlideGenerator {
  /**
   * @param {Object} api Authorized API client instance
   * @param {Object} presentation Initial presentation data
   * @private
   */
  constructor(api, presentation) {
    _defineProperty(this, "slides", void 0);

    _defineProperty(this, "api", void 0);

    _defineProperty(this, "presentation", void 0);

    _defineProperty(this, "allowUpload", false);

    this.api = api;
    this.presentation = presentation;
  }
  /**
   * Returns a generator that writes to a new blank presentation.
   *
   * @param {OAuth2Client} oauth2Client User credentials
   * @param {string} title Title of presentation
   * @returns {Promise.<SlideGenerator>}
   */


  static async newPresentation(oauth2Client, title) {
    let api = _googleapis.google.slides({
      version: 'v1',
      auth: oauth2Client
    });

    let res = await api.presentations.create({
      requestBody: {
        title: title
      }
    });
    let presentation = res.data;
    return new SlideGenerator(api, presentation);
  }
  /**
   * Returns a generator that copies an existing presentation.
   *
   * @param {OAuth2Client} oauth2Client User credentials
   * @param {string} title Title of presentation
   * @param {string} presentationId ID of presentation to copy
   * @returns {Promise.<SlideGenerator>}
   */


  static async copyPresentation(oauth2Client, title, presentationId) {
    let drive = _googleapis.google.drive({
      version: 'v3',
      auth: oauth2Client
    });

    let res = await drive.files.copy({
      fileId: presentationId,
      requestBody: {
        name: title
      }
    });
    return SlideGenerator.forPresentation(oauth2Client, res.data.id);
  }
  /**
   * Returns a generator that writes to an existing presentation.
   *
   * @param {gOAuth2Client} oauth2Client User credentials
   * @param {string} presentationId ID of presentation to use
   * @returns {Promise.<SlideGenerator>}
   */


  static async forPresentation(oauth2Client, presentationId) {
    let api = _googleapis.google.slides({
      version: 'v1',
      auth: oauth2Client
    });

    let res = await api.presentations.get({
      presentationId: presentationId
    });
    let presentation = res.data;
    return new SlideGenerator(api, presentation);
  }
  /**
   * Generate slides from markdown
   *
   * @param {String} markdown Markdown to import
   * @returns {Promise.<String>} ID of generated slide
   */


  async generateFromMarkdown(markdown, {
    css,
    useFileio
  }) {
    this.slides = (0, _extract_slides.default)(markdown, css);
    this.allowUpload = useFileio;
    await this.generateImages();
    await this.probeImageSizes();
    await this.uploadLocalImages();
    await this.updatePresentation(this.createSlides());
    await this.reloadPresentation();
    await this.updatePresentation(this.populateSlides());
    return this.presentation.presentationId;
  }
  /**
   * Removes any existing slides from the presentation.
   *
   * @returns {Promise.<*>}
   */


  async erase() {
    debug('Erasing previous slides');

    if (this.presentation.slides == null) {
      return Promise.resolve(null);
    }

    let requests = this.presentation.slides.map(slide => ({
      deleteObject: {
        objectId: slide.objectId
      }
    }));
    const batch = {
      requests
    };
    await this.api.presentations.batchUpdate({
      presentationId: this.presentation.presentationId,
      requestBody: batch
    });
  }

  async processImages(fn) {
    const promises = [];

    for (let slide of this.slides) {
      if (slide.backgroundImage) {
        promises.push(fn(slide.backgroundImage));
      }

      for (let body of slide.bodies) {
        for (let image of body.images) {
          promises.push(fn(image));
        }
      }
    }

    await Promise.all(promises);
  }

  async generateImages() {
    return this.processImages(_generate.default);
  }

  async uploadLocalImages() {
    const uploadImageifLocal = async image => {
      let parsedUrl = new _url.URL(image.url);

      if (parsedUrl.protocol !== 'file:') {
        return;
      }

      if (!this.allowUpload) {
        return Promise.reject('Local images require --use-fileio option');
      }

      image.url = await (0, _upload.default)(parsedUrl.pathname);
    };

    return this.processImages(uploadImageifLocal);
  }
  /**
   * Fetches the image sizes for each image in the presentation. Allows
   * for more accurate layout of images.
   *
   * Image sizes are stored as data attributes on the image elements.
   *
   * @returns {Promise.<*>}
   * @private
   */


  async probeImageSizes() {
    return this.processImages(_probe.default);
  }
  /**
   * 1st pass at generation -- creates slides using the apporpriate
   * layout based on the content.
   *
   * Note this only returns the batch requests, but does not execute it.
   *
   * @returns {{requests: Array}}
   */


  createSlides() {
    debug('Creating slides');
    const batch = {
      requests: []
    };

    for (let slide of this.slides) {
      const layout = (0, _match_layout.default)(this.presentation, slide);
      layout.appendCreateSlideRequest(batch.requests);
    }

    return batch;
  }
  /**
   * 2nd pass at generation -- fills in placeholders and adds any other
   * elements to the slides.
   *
   * Note this only returns the batch requests, but does not execute it.
   *
   * @returns {{requests: Array}}
   */


  populateSlides() {
    debug('Populating slides');
    const batch = {
      requests: []
    };

    for (let slide of this.slides) {
      const layout = (0, _match_layout.default)(this.presentation, slide);
      layout.appendContentRequests(batch.requests);
    }

    return batch;
  }
  /**
   * Updates the remote presentation.
   *
   * @param batch Batch of operations to execute
   * @returns {Promise.<*>}
   */


  async updatePresentation(batch) {
    debug('Updating presentation: %O', batch);

    if (batch.requests.length == 0) {
      return Promise.resolve(null);
    }

    let res = await this.api.presentations.batchUpdate({
      presentationId: this.presentation.presentationId,
      requestBody: batch
    });
    debug('API response: %O', res.data);
  }
  /**
   * Refreshes the local copy of the presentation.
   *
   * @returns {Promise.<*>}
   */


  async reloadPresentation() {
    let res = await this.api.presentations.get({
      presentationId: this.presentation.presentationId
    });
    this.presentation = res.data;
  }

}

exports.default = SlideGenerator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zbGlkZV9nZW5lcmF0b3IudHMiXSwibmFtZXMiOlsiZGVidWciLCJTbGlkZUdlbmVyYXRvciIsImNvbnN0cnVjdG9yIiwiYXBpIiwicHJlc2VudGF0aW9uIiwibmV3UHJlc2VudGF0aW9uIiwib2F1dGgyQ2xpZW50IiwidGl0bGUiLCJnb29nbGUiLCJzbGlkZXMiLCJ2ZXJzaW9uIiwiYXV0aCIsInJlcyIsInByZXNlbnRhdGlvbnMiLCJjcmVhdGUiLCJyZXF1ZXN0Qm9keSIsImRhdGEiLCJjb3B5UHJlc2VudGF0aW9uIiwicHJlc2VudGF0aW9uSWQiLCJkcml2ZSIsImZpbGVzIiwiY29weSIsImZpbGVJZCIsIm5hbWUiLCJmb3JQcmVzZW50YXRpb24iLCJpZCIsImdldCIsImdlbmVyYXRlRnJvbU1hcmtkb3duIiwibWFya2Rvd24iLCJjc3MiLCJ1c2VGaWxlaW8iLCJhbGxvd1VwbG9hZCIsImdlbmVyYXRlSW1hZ2VzIiwicHJvYmVJbWFnZVNpemVzIiwidXBsb2FkTG9jYWxJbWFnZXMiLCJ1cGRhdGVQcmVzZW50YXRpb24iLCJjcmVhdGVTbGlkZXMiLCJyZWxvYWRQcmVzZW50YXRpb24iLCJwb3B1bGF0ZVNsaWRlcyIsImVyYXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZXF1ZXN0cyIsIm1hcCIsInNsaWRlIiwiZGVsZXRlT2JqZWN0Iiwib2JqZWN0SWQiLCJiYXRjaCIsImJhdGNoVXBkYXRlIiwicHJvY2Vzc0ltYWdlcyIsImZuIiwicHJvbWlzZXMiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJwdXNoIiwiYm9keSIsImJvZGllcyIsImltYWdlIiwiaW1hZ2VzIiwiYWxsIiwibWF5YmVHZW5lcmF0ZUltYWdlIiwidXBsb2FkSW1hZ2VpZkxvY2FsIiwicGFyc2VkVXJsIiwiVVJMIiwidXJsIiwicHJvdG9jb2wiLCJyZWplY3QiLCJwYXRobmFtZSIsInByb2JlSW1hZ2UiLCJsYXlvdXQiLCJhcHBlbmRDcmVhdGVTbGlkZVJlcXVlc3QiLCJhcHBlbmRD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QkFBRCxFQUE4QitDLEtBQTlCLENBQUw7O0FBQ0EsUUFBSUEsS0FBSyxDQUFDTCxRQUFOLENBQWU2QixNQUFmLElBQXlCLENBQTdCLEVBQWdDO0FBQzVCLGFBQU8vQixPQUFPLENBQUNDLE9BQVIsQ0FBZ0IsSUFBaEIsQ0FBUDtBQUNIOztBQUNELFFBQUk3QixHQUFHLEdBQUcsTUFBTSxLQUFLVCxHQUFMLENBQVNVLGFBQVQsQ0FBdUJtQyxXQUF2QixDQUFtQztBQUMvQzlCLE1BQUFBLGNBQWMsRUFBRSxLQUFLZCxZQUFMLENBQWtCYyxjQURhO0FBRS9DSCxNQUFBQSxXQUFXLEVBQUVnQztBQUZrQyxLQUFuQyxDQUFoQjtBQUlBL0MsSUFBQUEsS0FBSyxDQUFDLGtCQUFELEVBQXFCWSxHQUFHLENBQUNJLElBQXpCLENBQUw7QUFDSDtBQUVEO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7OztBQUNJLFFBQWdCcUIsa0JBQWhCLEdBQW9EO0FBQ2hELFFBQUl6QixHQUFHLEdBQUcsTUFBTSxLQUFLVCxHQUFMLENBQVNVLGFBQVQsQ0FBdUJhLEdBQXZCLENBQTJCO0FBQ3ZDUixNQUFBQSxjQUFjLEVBQUUsS0FBS2QsWUFBTCxDQUFrQmM7QUFESyxLQUEzQixDQUFoQjtBQUdBLFNBQUtkLFlBQUwsR0FBb0JRLEdBQUcsQ0FBQ0ksSUFBeEI7QUFDSDs7QUFoTytCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTYgR29vZ2xlIEluYy5cbi8vXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuLy8gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuLy8gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuLy8gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4vLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4vLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IERlYnVnIGZyb20gJ2RlYnVnJztcbmltcG9ydCBleHRyYWN0U2xpZGVzIGZyb20gJy4vcGFyc2VyL2V4dHJhY3Rfc2xpZGVzJztcbmltcG9ydCB7IFNsaWRlRGVmaW5pdGlvbiwgSW1hZ2VEZWZpbml0aW9uIH0gZnJvbSAnLi9zbGlkZXMnO1xuaW1wb3J0IG1hdGNoTGF5b3V0IGZyb20gJy4vbGF5b3V0L21hdGNoX2xheW91dCc7XG5pbXBvcnQgeyBVUkwgfSBmcm9tICd1cmwnO1xuaW1wb3J0IHsgZ29vZ2xlLCBzbGlkZXNfdjEgYXMgU2xpZGVzVjEgfSBmcm9tICdnb29nbGVhcGlzJztcbmltcG9ydCB1cGxvYWRMb2NhbEltYWdlIGZyb20gJy4vaW1hZ2VzL3VwbG9hZCc7XG5pbXBvcnQgeyBPQXV0aDJDbGllbnQgfSBmcm9tICdnb29nbGUtYXV0aC1saWJyYXJ5JztcbmltcG9ydCBwcm9iZUltYWdlIGZyb20gJy4vaW1hZ2VzL3Byb2JlJztcbmltcG9ydCBtYXliZUdlbmVyYXRlSW1hZ2UgZnJvbSAnLi9pbWFnZXMvZ2VuZXJhdGUnO1xuXG5jb25zdCBkZWJ1ZyA9IERlYnVnKCdtZDJnc2xpZGVzJyk7XG5cbi8qKlxuICogR2VuZXJhdGVzIHNsaWRlcyBmcm9tIE1hcmtkb3duIG9yIEhUTUwuIFJlcXVpcmVzIGFuIGF1dGhvcml6ZWRcbiAqIG9hdXRoMiBjbGllbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAgIHZhciBTbGlkZUdlbmVyYXRvciA9IHJlcXVpcmUoJ21kMnNsaWRlcycpO1xuICogICB2YXIgZnMgPSByZXF1aXJlKCdmcycpO1xuICpcbiAqICAgdmFyIG9hdXRoMkNsaWVudCA9IC4uLjsgLy8gU2VlIEdvb2dsZSBBUEkgY2xpZW50IGZvciBkZXRhaWxzXG4gKiAgIHZhciBnZW5lcmF0b3IgPSBTbGlkZUdlbmVyYXRvci5uZXdQcmVzZW50YXRpb24ob2F1dGgyQ2xpZW50KTtcbiAqICAgdmFyIG1hcmtkb3duID0gZnMucmVhZEZpbGVTeW5jKCdteWRlY2subWQnKTtcbiAqICAgZ2VuZXJhdG9yLmdlbmVyYXRlRnJvbU1hcmtkb3duKG1hcmtkb3duKS50aGVuKGZ1bmN0aW9uKGlkKSB7XG4gKiAgICAgY29uc29sZS5sb2coXCJQcmVzZW50YXRpb24gSUQ6IFwiICsgaWQpO1xuICogICB9KTtcbiAqXG4gKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvZ29vZ2xlLWFwaS1ub2RlanMtY2xpZW50XG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNsaWRlR2VuZXJhdG9yIHtcbiAgICBwcml2YXRlIHNsaWRlczogU2xpZGVEZWZpbml0aW9uW107XG4gICAgcHJpdmF0ZSBhcGk6IFNsaWRlc1YxLlNsaWRlcztcbiAgICBwcml2YXRlIHByZXNlbnRhdGlvbjogU2xpZGVzVjEuU2NoZW1hJFByZXNlbnRhdGlvbjtcbiAgICBwcml2YXRlIGFsbG93VXBsb2FkID0gZmFsc2U7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGFwaSBBdXRob3JpemVkIEFQSSBjbGllbnQgaW5zdGFuY2VcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcHJlc2VudGF0aW9uIEluaXRpYWwgcHJlc2VudGF0aW9uIGRhdGFcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihhcGk6IFNsaWRlc1YxLlNsaWRlcywgcHJlc2VudGF0aW9uOiBTbGlkZXNWMS5TY2hlbWEkUHJlc2VudGF0aW9uKSB7XG4gICAgICAgIHRoaXMuYXBpID0gYXBpO1xuICAgICAgICB0aGlzLnByZXNlbnRhdGlvbiA9IHByZXNlbnRhdGlvbjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgZ2VuZXJhdG9yIHRoYXQgd3JpdGVzIHRvIGEgbmV3IGJsYW5rIHByZXNlbnRhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T0F1dGgyQ2xpZW50fSBvYXV0aDJDbGllbnQgVXNlciBjcmVkZW50aWFsc1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0aXRsZSBUaXRsZSBvZiBwcmVzZW50YXRpb25cbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZS48U2xpZGVHZW5lcmF0b3I+fVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgbmV3UHJlc2VudGF0aW9uKG9hdXRoMkNsaWVudDogT0F1dGgyQ2xpZW50LCB0aXRsZTogc3RyaW5nKTogUHJvbWlzZTxTbGlkZUdlbmVyYXRvcj4ge1xuICAgICAgICBsZXQgYXBpID0gZ29vZ2xlLnNsaWRlcyh7IHZlcnNpb246ICd2MScsIGF1dGg6IG9hdXRoMkNsaWVudCB9KTtcbiAgICAgICAgbGV0IHJlcyA9IGF3YWl0IGFwaS5wcmVzZW50YXRpb25zLmNyZWF0ZSh7XG4gICAgICAgICAgICByZXF1ZXN0Qm9keToge1xuICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgcHJlc2VudGF0aW9uID0gcmVzLmRhdGE7XG4gICAgICAgIHJldHVybiBuZXcgU2xpZGVHZW5lcmF0b3IoYXBpLCBwcmVzZW50YXRpb24pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBnZW5lcmF0b3IgdGhhdCBjb3BpZXMgYW4gZXhpc3RpbmcgcHJlc2VudGF0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPQXV0aDJDbGllbnR9IG9hdXRoMkNsaWVudCBVc2VyIGNyZWRlbnRpYWxzXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRpdGxlIFRpdGxlIG9mIHByZXNlbnRhdGlvblxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcmVzZW50YXRpb25JZCBJRCBvZiBwcmVzZW50YXRpb24gdG8gY29weVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlLjxTbGlkZUdlbmVyYXRvcj59XG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBjb3B5UHJlc2VudGF0aW9uKFxuICAgICAgICBvYXV0aDJDbGllbnQ6IE9BdXRoMkNsaWVudCxcbiAgICAgICAgdGl0bGU6IHN0cmluZyxcbiAgICAgICAgcHJlc2VudGF0aW9uSWQ6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPFNsaWRlR2VuZXJhdG9yPiB7XG4gICAgICAgIGxldCBkcml2ZSA9IGdvb2dsZS5kcml2ZSh7IHZlcnNpb246ICd2MycsIGF1dGg6IG9hdXRoMkNsaWVudCB9KTtcbiAgICAgICAgbGV0IHJlcyA9IGF3YWl0IGRyaXZlLmZpbGVzLmNvcHkoe1xuICAgICAgICAgICAgZmlsZUlkOiBwcmVzZW50YXRpb25JZCxcbiAgICAgICAgICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICAgICAgICAgICAgbmFtZTogdGl0bGUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFNsaWRlR2VuZXJhdG9yLmZvclByZXNlbnRhdGlvbihvYXV0aDJDbGllbnQsIHJlcy5kYXRhLmlkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgZ2VuZXJhdG9yIHRoYXQgd3JpdGVzIHRvIGFuIGV4aXN0aW5nIHByZXNlbnRhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Z09BdXRoMkNsaWVudH0gb2F1dGgyQ2xpZW50IFVzZXIgY3JlZGVudGlhbHNcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJlc2VudGF0aW9uSWQgSUQgb2YgcHJlc2VudGF0aW9uIHRvIHVzZVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlLjxTbGlkZUdlbmVyYXRvcj59XG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBmb3JQcmVzZW50YXRpb24ob2F1dGgyQ2xpZW50OiBPQXV0aDJDbGllbnQsIHByZXNlbnRhdGlvbklkKTogUHJvbWlzZTxTbGlkZUdlbmVyYXRvcj4ge1xuICAgICAgICBsZXQgYXBpID0gZ29vZ2xlLnNsaWRlcyh7IHZlcnNpb246ICd2MScsIGF1dGg6IG9hdXRoMkNsaWVudCB9KTtcbiAgICAgICAgbGV0IHJlcyA9IGF3YWl0IGFwaS5wcmVzZW50YXRpb25zLmdldCh7IHByZXNlbnRhdGlvbklkOiBwcmVzZW50YXRpb25JZCB9KTtcbiAgICAgICAgbGV0IHByZXNlbnRhdGlvbiA9IHJlcy5kYXRhO1xuICAgICAgICByZXR1cm4gbmV3IFNsaWRlR2VuZXJhdG9yKGFwaSwgcHJlc2VudGF0aW9uKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmF0ZSBzbGlkZXMgZnJvbSBtYXJrZG93blxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG1hcmtkb3duIE1hcmtkb3duIHRvIGltcG9ydFxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlLjxTdHJpbmc+fSBJRCBvZiBnZW5lcmF0ZWQgc2xpZGVcbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgZ2VuZXJhdGVGcm9tTWFya2Rvd24obWFya2Rvd24sIHsgY3NzLCB1c2VGaWxlaW8gfSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIHRoaXMuc2xpZGVzID0gZXh0cmFjdFNsaWRlcyhtYXJrZG93biwgY3NzKTtcbiAgICAgICAgdGhpcy5hbGxvd1VwbG9hZCA9IHVzZUZpbGVpbztcbiAgICAgICAgYXdhaXQgdGhpcy5nZW5lcmF0ZUltYWdlcygpO1xuICAgICAgICBhd2FpdCB0aGlzLnByb2JlSW1hZ2VTaXplcygpO1xuICAgICAgICBhd2FpdCB0aGlzLnVwbG9hZExvY2FsSW1hZ2VzKCk7XG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlUHJlc2VudGF0aW9uKHRoaXMuY3JlYXRlU2xpZGVzKCkpO1xuICAgICAgICBhd2FpdCB0aGlzLnJlbG9hZFByZXNlbnRhdGlvbigpO1xuICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZVByZXNlbnRhdGlvbih0aGlzLnBvcHVsYXRlU2xpZGVzKCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5wcmVzZW50YXRpb24ucHJlc2VudGF0aW9uSWQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhbnkgZXhpc3Rpbmcgc2xpZGVzIGZyb20gdGhlIHByZXNlbnRhdGlvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlLjwqPn1cbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgZXJhc2UoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGRlYnVnKCdFcmFzaW5nIHByZXZpb3VzIHNsaWRlcycpO1xuICAgICAgICBpZiAodGhpcy5wcmVzZW50YXRpb24uc2xpZGVzID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmVxdWVzdHMgPSB0aGlzLnByZXNlbnRhdGlvbi5zbGlkZXMubWFwKHNsaWRlID0+ICh7XG4gICAgICAgICAgICBkZWxldGVPYmplY3Q6IHtcbiAgICAgICAgICAgICAgICBvYmplY3RJZDogc2xpZGUub2JqZWN0SWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KSk7XG4gICAgICAgIGNvbnN0IGJhdGNoID0geyByZXF1ZXN0cyB9O1xuICAgICAgICBhd2FpdCB0aGlzLmFwaS5wcmVzZW50YXRpb25zLmJhdGNoVXBkYXRlKHtcbiAgICAgICAgICAgIHByZXNlbnRhdGlvbklkOiB0aGlzLnByZXNlbnRhdGlvbi5wcmVzZW50YXRpb25JZCxcbiAgICAgICAgICAgIHJlcXVlc3RCb2R5OiBiYXRjaCxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFzeW5jIHByb2Nlc3NJbWFnZXM8VD4oZm46IChpbWc6IEltYWdlRGVmaW5pdGlvbikgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBwcm9taXNlcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBzbGlkZSBvZiB0aGlzLnNsaWRlcykge1xuICAgICAgICAgICAgaWYgKHNsaWRlLmJhY2tncm91bmRJbWFnZSkge1xuICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goZm4oc2xpZGUuYmFja2dyb3VuZEltYWdlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGxldCBib2R5IG9mIHNsaWRlLmJvZGllcykge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGltYWdlIG9mIGJvZHkuaW1hZ2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goZm4oaW1hZ2UpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgYXN5bmMgZ2VuZXJhdGVJbWFnZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NJbWFnZXMobWF5YmVHZW5lcmF0ZUltYWdlKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXN5bmMgdXBsb2FkTG9jYWxJbWFnZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHVwbG9hZEltYWdlaWZMb2NhbCA9IGFzeW5jIChpbWFnZSk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICAgICAgbGV0IHBhcnNlZFVybCA9IG5ldyBVUkwoaW1hZ2UudXJsKTtcbiAgICAgICAgICAgIGlmIChwYXJzZWRVcmwucHJvdG9jb2wgIT09ICdmaWxlOicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuYWxsb3dVcGxvYWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ0xvY2FsIGltYWdlcyByZXF1aXJlIC0tdXNlLWZpbGVpbyBvcHRpb24nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGltYWdlLnVybCA9IGF3YWl0IHVwbG9hZExvY2FsSW1hZ2UocGFyc2VkVXJsLnBhdGhuYW1lKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0ltYWdlcyh1cGxvYWRJbWFnZWlmTG9jYWwpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoZXMgdGhlIGltYWdlIHNpemVzIGZvciBlYWNoIGltYWdlIGluIHRoZSBwcmVzZW50YXRpb24uIEFsbG93c1xuICAgICAqIGZvciBtb3JlIGFjY3VyYXRlIGxheW91dCBvZiBpbWFnZXMuXG4gICAgICpcbiAgICAgKiBJbWFnZSBzaXplcyBhcmUgc3RvcmVkIGFzIGRhdGEgYXR0cmlidXRlcyBvbiB0aGUgaW1hZ2UgZWxlbWVudHMuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZS48Kj59XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgYXN5bmMgcHJvYmVJbWFnZVNpemVzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzSW1hZ2VzKHByb2JlSW1hZ2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIDFzdCBwYXNzIGF0IGdlbmVyYXRpb24gLS0gY3JlYXRlcyBzbGlkZXMgdXNpbmcgdGhlIGFwcG9ycHJpYXRlXG4gICAgICogbGF5b3V0IGJhc2VkIG9uIHRoZSBjb250ZW50LlxuICAgICAqXG4gICAgICogTm90ZSB0aGlzIG9ubHkgcmV0dXJucyB0aGUgYmF0Y2ggcmVxdWVzdHMsIGJ1dCBkb2VzIG5vdCBleGVjdXRlIGl0LlxuICAgICAqXG4gICAgICogQHJldHVybnMge3tyZXF1ZXN0czogQXJyYXl9fVxuICAgICAqL1xuICAgIHByb3RlY3RlZCBjcmVhdGVTbGlkZXMoKTogU2xpZGVzVjEuU2NoZW1hJEJhdGNoVXBkYXRlUHJlc2VudGF0aW9uUmVxdWVzdCB7XG4gICAgICAgIGRlYnVnKCdDcmVhdGluZyBzbGlkZXMnKTtcbiAgICAgICAgY29uc3QgYmF0Y2ggPSB7XG4gICAgICAgICAgICByZXF1ZXN0czogW10sXG4gICAgICAgIH07XG4gICAgICAgIGZvciAobGV0IHNsaWRlIG9mIHRoaXMuc2xpZGVzKSB7XG4gICAgICAgICAgICBjb25zdCBsYXlvdXQgPSBtYXRjaExheW91dCh0aGlzLnByZXNlbnRhdGlvbiwgc2xpZGUpO1xuICAgICAgICAgICAgbGF5b3V0LmFwcGVuZENyZWF0ZVNsaWRlUmVxdWVzdChiYXRjaC5yZXF1ZXN0cyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJhdGNoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIDJuZCBwYXNzIGF0IGdlbmVyYXRpb24gLS0gZmlsbHMgaW4gcGxhY2Vob2xkZXJzIGFuZCBhZGRzIGFueSBvdGhlclxuICAgICAqIGVsZW1lbnRzIHRvIHRoZSBzbGlkZXMuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoaXMgb25seSByZXR1cm5zIHRoZSBiYXRjaCByZXF1ZXN0cywgYnV0IGRvZXMgbm90IGV4ZWN1dGUgaXQuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7e3JlcXVlc3RzOiBBcnJheX19XG4gICAgICovXG4gICAgcHJvdGVjdGVkIHBvcHVsYXRlU2xpZGVzKCk6IFNsaWRlc1YxLlNjaGVtYSRCYXRjaFVwZGF0ZVByZXNlbnRhdGlvblJlcXVlc3Qge1xuICAgICAgICBkZWJ1ZygnUG9wdWxhdGluZyBzbGlkZXMnKTtcbiAgICAgICAgY29uc3QgYmF0Y2ggPSB7XG4gICAgICAgICAgICByZXF1ZXN0czogW10sXG4gICAgICAgIH07XG4gICAgICAgIGZvciAobGV0IHNsaWRlIG9mIHRoaXMuc2xpZGVzKSB7XG4gICAgICAgICAgICBjb25zdCBsYXlvdXQgPSBtYXRjaExheW91dCh0aGlzLnByZXNlbnRhdGlvbiwgc2xpZGUpO1xuICAgICAgICAgICAgbGF5b3V0LmFwcGVuZENvbnRlbnRSZXF1ZXN0cyhiYXRjaC5yZXF1ZXN0cyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJhdGNoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIHJlbW90ZSBwcmVzZW50YXRpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYmF0Y2ggQmF0Y2ggb2Ygb3BlcmF0aW9ucyB0byBleGVjdXRlXG4gICAgICogQHJldHVybnMge1Byb21pc2UuPCo+fVxuICAgICAqL1xuICAgIHByb3RlY3RlZCBhc3luYyB1cGRhdGVQcmVzZW50YXRpb24oYmF0Y2gpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgZGVidWcoJ1VwZGF0aW5nIHByZXNlbnRhdGlvbjogJU8nLCBiYXRjaCk7XG4gICAgICAgIGlmIChiYXRjaC5yZXF1ZXN0cy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy5hcGkucHJlc2VudGF0aW9ucy5iYXRjaFVwZGF0ZSh7XG4gICAgICAgICAgICBwcmVzZW50YXRpb25JZDogdGhpcy5wcmVzZW50YXRpb24ucHJlc2VudGF0aW9uSWQsXG4gICAgICAgICAgICByZXF1ZXN0Qm9keTogYmF0Y2gsXG4gICAgICAgIH0pO1xuICAgICAgICBkZWJ1ZygnQVBJIHJlc3BvbnNlOiAlTycsIHJlcy5kYXRhKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWZyZXNoZXMgdGhlIGxvY2FsIGNvcHkgb2YgdGhlIHByZXNlbnRhdGlvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlLjwqPn1cbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgYXN5bmMgcmVsb2FkUHJlc2VudGF0aW9uKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy5hcGkucHJlc2VudGF0aW9ucy5nZXQoe1xuICAgICAgICAgICAgcHJlc2VudGF0aW9uSWQ6IHRoaXMucHJlc2VudGF0aW9uLnByZXNlbnRhdGlvbklkLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wcmVzZW50YXRpb24gPSByZXMuZGF0YTtcbiAgICB9XG59XG4iXX0=
//# sourceMappingURL=slide_generator.js.map